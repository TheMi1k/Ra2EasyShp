<Window x:Class="Ra2EasyShp.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:Ra2EasyShp"
        mc:Ignorable="d"
        Title="Ra2EasyShp" FontSize="15" Width="1160" Height="860"
        MinWidth="560" MinHeight="475"
      
        ResizeMode="CanResizeWithGrip"
        PreviewKeyDown="Window_PreviewKeyDown"
        >

    <!--MinHeight="780" MinWidth="1160"-->
    <Window.Resources>
        <local:BindingProxy x:Key="Proxy" Data="{Binding}"/>
        
        <Style x:Key="MyStyle">
            <Setter Property="Control.FontFamily" Value="NSimSun"/>
            <Setter Property="Control.FontWeight" Value="Normal"/>
            <Setter Property="TextOptions.TextFormattingMode" Value="Display"/>
            <Setter Property="Control.HorizontalAlignment" Value="Left"/>
            <Setter Property="Control.VerticalAlignment" Value="Top"/>
        </Style>
    </Window.Resources>

    <Grid x:Name="Grid_Main" Width="auto" Height="auto">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <Menu Grid.Row="0" Grid.Column="0" FontSize="15" IsEnabled="{Binding UIEnable}">
            <MenuItem StaysOpenOnClick="True" IsHitTestVisible="False" BorderThickness="0" Padding="0">
                <MenuItem.Header>
                    <Border Width="1" Height="20" Background="Gray" Margin="5,0"/>
                </MenuItem.Header>
            </MenuItem>
            
            <MenuItem HorizontalContentAlignment="Left" Margin="0 0 0 0" >
                <MenuItem.Header>
                    <TextBlock d:Text="其他" Text="{Binding LanguageDic[Menu_Other]}"/>
                </MenuItem.Header>
                <MenuItem d:Header="关于" Header="{Binding LanguageDic[Menu_About]}" HorizontalContentAlignment="Left" Click="MenuItem_About_Click"/>
            </MenuItem>

            <MenuItem StaysOpenOnClick="True" IsHitTestVisible="False" BorderThickness="0" Padding="0">
                <MenuItem.Header>
                    <Border Width="1" Height="20" Background="Gray" Margin="5,0"/>
                </MenuItem.Header>
            </MenuItem>

            <MenuItem d:Header="查看快捷键" Header="{Binding LanguageDic[Menu_ShortcutKeys]}" HorizontalContentAlignment="Left" Click="MenuItem_HotKeyView_Click"/>

            <MenuItem StaysOpenOnClick="True" IsHitTestVisible="False" BorderThickness="0" Padding="0">
                <MenuItem.Header>
                    <Border Width="1" Height="20" Background="Gray" Margin="5,0"/>
                </MenuItem.Header>
            </MenuItem>

            <MenuItem HorizontalContentAlignment="Left" Margin="0 0 0 0">
                <MenuItem.Header>
                    <StackPanel Orientation="Horizontal">
                        <Path Width="15" Height="15" Stretch="Fill" Fill="Black" Data="M512 64c247.424 0 448 200.576 448 448S759.424 960 512 960 64 759.424 64 512 264.576 64 512 64z m340.6 625.504l-152.385-0.003c-26.47 67.398-67.875 134.461-124.049 201.152v0.01c120.416-20.257 221.81-96.56 276.435-201.159z m-529.541-0.003l-151.66 0.003c54.495 104.353 155.541 180.543 275.585 201.015v-0.011c-56.11-66.643-97.475-133.658-123.925-201.007z m316.473 0h-255.79c27.86 62.945 70.428 126.25 127.891 189.957 56.896-63.07 99.186-125.746 127.06-188.07l0.84-1.888zM303.73 390.5H147.62C134.892 428.685 128 469.538 128 512c0 42.463 6.892 83.316 19.619 121.501h156.91C293.521 592.616 288 551.613 288 510.5c0-39.47 5.09-78.84 15.235-118.1l0.495-1.9z m357.646 0H361.898C349.95 430.638 344 470.635 344 510.5c0 40.859 6.25 81.855 18.802 123h297.67c12.552-41.145 18.802-82.141 18.802-123 0-39.865-5.95-79.862-17.898-120z m215.005 0H719.544c10.475 39.89 15.73 79.893 15.73 120 0 41.113-5.522 82.116-16.528 123.001H876.38C889.108 595.316 896 554.463 896 512c0-42.462-6.892-83.315-19.619-121.5zM444.047 133.996l-0.4 0.07C325.07 155.368 225.388 231.11 171.4 334.496l150.491 0.004c25.937-67.18 66.713-134.027 122.157-200.505z m67.594 7.547l-1.391 1.536c-57.673 64.2-100.218 127.993-127.826 191.422H640.85c-27.828-63.935-70.832-128.24-129.209-192.958z m67.461-7.7l1.366 1.645C635.28 201.473 675.64 267.823 701.383 334.5l151.218-0.004c-54.179-103.749-154.371-179.66-273.499-200.654z"/>
                        <TextBlock d:Text="语言" Text="{Binding LanguageDic[Menu_Language]}" Margin="5 0 0 0"/>
                    </StackPanel>
                </MenuItem.Header>
                
                <MenuItem Header="中文(简体)" HorizontalContentAlignment="Left" Click="MenuItem_Language_ChineseSimplified_Click"/>
                <MenuItem Header="English" HorizontalContentAlignment="Left" Click="MenuItem_Language_English_Click"/>
                <MenuItem d:Header="..." Header="{Binding LanguageDic[Menu_Language_Other]}" HorizontalContentAlignment="Left" Click="MenuItem_Language_Other_Click"/>
            </MenuItem>
            
            <MenuItem StaysOpenOnClick="True" IsHitTestVisible="False" BorderThickness="0" Padding="0">
                <MenuItem.Header>
                    <Border Width="1" Height="20" Background="Gray" Margin="5,0"/>
                </MenuItem.Header>
            </MenuItem>
        </Menu>

        <Grid Grid.Row="1" Grid.Column="0" Margin="5 5 5 20">
            <Grid.RowDefinitions>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="0.4*"/>
            </Grid.ColumnDefinitions>

            <!--图片列表区-->
            <Viewbox Grid.Row="0" Grid.Column="0" HorizontalAlignment="Left">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="auto"/>
                    </Grid.RowDefinitions>

                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="auto"/>
                    </Grid.ColumnDefinitions>

                    <DataGrid x:Name="DataGrid_Images"
                            Grid.Row="0" Grid.Column="0"
                            Drop="Img_Drop" AllowDrop="True"
                            VerticalAlignment="Top"
                            Height="720"
                            Width="260"
                            IsEnabled="{Binding UIEnable}"
                            MouseDoubleClick="DataGrid_Images_DoubleClick"
                            AutoGenerateColumns="False"
                            RowHeaderWidth="0"
                            IsReadOnly="True"
                            CanUserSortColumns="False"
                            CanUserResizeColumns="False"
                            CanUserResizeRows="False"
                            CanUserReorderColumns="False"
                            SelectionUnit="Cell"
                            PreviewKeyDown="DataGrid_Images_KeyDown"
                            ContextMenuOpening="DataGrid_ContextMenuOpening"
                            PreviewMouseRightButtonDown="DataGrid_Image_MouseRightButtonDown"
                            PreviewMouseLeftButtonDown="DataGrid_Images_PreviewMouseDown"
                        >
                        <DataGrid.CellStyle>
                            <Style TargetType="DataGridCell">
                                <Style.Triggers>
                                    <Trigger Property="IsSelected" Value="True">
                                        <Setter Property="Background" Value="DeepSkyBlue"/>
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </DataGrid.CellStyle>

                        <DataGrid.ContextMenu>
                            <ContextMenu x:Name="DataGridContextMenu" FontSize="15">
                                <MenuItem x:Name="MenuItem1" d:Header="插入空项" Header="{Binding Data.LanguageDic[Btn_List_InsertEmptyItem], Source={StaticResource Proxy}}">
                                    <MenuItem Click="MenuItem_DataGrid_Image_InsertAbove_Click">
                                        <MenuItem.Header>
                                            <StackPanel Orientation="Horizontal" Height="30">
                                                <TextBlock d:Text="到上方" Text="{Binding Data.LanguageDic[Btn_List_InsertEmptyItemAbove], Source={StaticResource Proxy}}" MinWidth="50" VerticalAlignment="Center"/>
                                                <TextBox x:Name="TextBox_DataGrid_Image_InsertAbove" Text="1" Width="50" Height="20" Padding="0 0 0 0" Margin="10 0 0 0" VerticalAlignment="Center"/>
                                                <TextBlock d:Text="行" Text="{Binding Data.LanguageDic[Btn_List_InsertEmptyItemCount], Source={StaticResource Proxy}}" Margin="10 0 0 0" VerticalAlignment="Center"/>
                                                <Path Width="15" Height="15" Stretch="Fill" Fill="Black" Margin="20 0 0 0" HorizontalAlignment="Right" VerticalAlignment="Center" Data="M345.781 890.168 0 544.571l77.181-77.187 268.601 268.234 601.781-601.786 77.186 77.366L345.781 890.168z"/>
                                            </StackPanel>
                                        </MenuItem.Header>
                                    </MenuItem>

                                    <MenuItem Click="MenuItem_DataGrid_Image_InsertBelow_Click">
                                        <MenuItem.Header>
                                            <StackPanel Orientation="Horizontal" Height="30">
                                                <TextBlock d:Text="到下方" Text="{Binding Data.LanguageDic[Btn_List_InsertEmptyItemBelow], Source={StaticResource Proxy}}" MinWidth="50" VerticalAlignment="Center"/>
                                                <TextBox x:Name="TextBox_DataGrid_Image_InsertBelow" Text="1" Width="50" Height="20" Padding="0 0 0 0" Margin="10 0 0 0" VerticalAlignment="Center"/>
                                                <TextBlock d:Text="行" Text="{Binding Data.LanguageDic[Btn_List_InsertEmptyItemCount], Source={StaticResource Proxy}}" Margin="10 0 0 0" VerticalAlignment="Center"/>
                                                <Path Width="15" Height="15" Stretch="Fill" Fill="Black" Margin="20 0 0 0" HorizontalAlignment="Right" VerticalAlignment="Center" Data="M345.781 890.168 0 544.571l77.181-77.187 268.601 268.234 601.781-601.786 77.186 77.366L345.781 890.168z"/>
                                            </StackPanel>
                                        </MenuItem.Header>
                                    </MenuItem>
                                </MenuItem>

                                <Separator Height="2"/>

                                <MenuItem x:Name="MenuItem_DataGrid_Images_Copy" d:Header="复制" Header="{Binding Data.LanguageDic[Btn_List_Copy], Source={StaticResource Proxy}}" InputGestureText="Ctrl+C" Click="MenuItem_DataGrid_Images_Copy_Click"/>
                                <MenuItem x:Name="MenuItem_DataGrid_Images_Cut" d:Header="剪切" Header="{Binding Data.LanguageDic[Btn_List_Cut], Source={StaticResource Proxy}}" InputGestureText="Ctrl+X" Click="MenuItem_DataGrid_Images_Cut_Click"/>
                                <MenuItem x:Name="MenuItem_DataGrid_Images_CutRemoveEmpty" d:Header="剪切不保留空行" Header="{Binding Data.LanguageDic[Btn_List_CutRemoveEmpty], Source={StaticResource Proxy}}" InputGestureText="Ctrl+Shift+X" Click="MenuItem_DataGrid_Images_CutRemoveEmpty_Click"/>

                                <Separator Height="2"/>

                                <MenuItem x:Name="MenuItem_DataGrid_Images_Paste" d:Header="粘贴" Header="{Binding Data.LanguageDic[Btn_List_Paste], Source={StaticResource Proxy}}" InputGestureText="Ctrl+V" Click="MenuItem_DataGrid_Images_Paste_Click"/>
                                <MenuItem x:Name="MenuItem_DataGrid_Images_PasteInsertAbove" d:Header="插入粘贴到上方" Header="{Binding Data.LanguageDic[Btn_List_PasteInsertAbove], Source={StaticResource Proxy}}" InputGestureText="Ctrl+Shift+V" Click="MenuItem_DataGrid_Images_PasteInsertAbove_Click"/>
                                <MenuItem x:Name="MenuItem_DataGrid_Images_PasteInsertBelow" d:Header="插入粘贴到下方" Header="{Binding Data.LanguageDic[Btn_List_PasteInsertBelow], Source={StaticResource Proxy}}" InputGestureText="Ctrl+Alt+V" Click="MenuItem_DataGrid_Images_PasteInsertBelow_Click"/>

                                <Separator Height="2"/>

                                <MenuItem x:Name="MenuItem_DataGrid_Images_DeleteItem" d:Header="删除保留空行" Header="{Binding Data.LanguageDic[Btn_List_Delete], Source={StaticResource Proxy}}" InputGestureText="Ctrl+D" Click="MenuItem_DataGrid_Images_DeleteItem_Click"/>
                                <MenuItem x:Name="MenuItem_DataGrid_Images_DeleteItemRemoveEmpty" d:Header="删除移除空行" Header="{Binding Data.LanguageDic[Btn_List_DeleteRemoveEmpty], Source={StaticResource Proxy}}" InputGestureText="Ctrl+Shift+D" Click="MenuItem_DataGrid_Images_DeleteItemRemoveEmpty_Click"/>
                                
                                <Separator Height="2"/>

                                <MenuItem d:Header="清空操作列表" Header="{Binding Data.LanguageDic[Btn_List_ClearEditList], Source={StaticResource Proxy}}" Click="MenuItem_DataGrid_Images_ClearEditList_Click"/>
                                <MenuItem d:Header="清空叠加列表" Header="{Binding Data.LanguageDic[Btn_List_ClearOverlayList], Source={StaticResource Proxy}}" Click="MenuItem_DataGrid_Images_ClearOverlayList_Click"/>
                            </ContextMenu>
                        </DataGrid.ContextMenu>

                        <DataGrid.Columns>
                            <DataGridTemplateColumn Width="40" >
                                <DataGridTemplateColumn.Header>
                                    <TextBlock Text=""/>
                                </DataGridTemplateColumn.Header>

                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding IndexStr}" FontSize="12.5" Foreground="Black" Height="17" Margin="0 4 0 0"/>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>

                            <DataGridTemplateColumn Width="100">
                                <DataGridTemplateColumn.Header>
                                    <TextBlock d:Text="操作图片列表" Text="{Binding DataContext.LanguageDic[Text_EditImageList], RelativeSource={RelativeSource AncestorType=Window}}" FontSize="14"/>
                                </DataGridTemplateColumn.Header>

                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding EditImage.Name}" FontSize="13" Foreground="{Binding EditImage.StrColor}" Height="17" Margin="2 4 0 0"/>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>

                            <DataGridTemplateColumn Width="100">
                                <DataGridTemplateColumn.Header>
                                    <TextBlock d:Text="叠加图片列表" Text="{Binding DataContext.LanguageDic[Text_OverlayImageList], RelativeSource={RelativeSource AncestorType=Window}}" FontSize="14" />
                                </DataGridTemplateColumn.Header>

                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding OverlayImage.Name}" FontSize="13" Foreground="{Binding OverlayImage.StrColor}" Height="17" Margin="2 4 0 0"/>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                        </DataGrid.Columns>
                    </DataGrid>

                    <StackPanel x:Name="StackPanel_Tips" Grid.Row="0" Grid.Column="0" Margin="0 120 0 0" HorizontalAlignment="Center" VerticalAlignment="Top" Panel.ZIndex="1" IsHitTestVisible="False">
                        <TextBlock d:Text="操作提示：" Text="{Binding LanguageDic[Text_ToolTip]}" FontSize="30" HorizontalAlignment="Center"/>
                        <TextBlock d:Text="将图片拖到对应列表载入" Text="{Binding LanguageDic[Text_ToolTip_1]}" FontSize="20" HorizontalAlignment="Center" Margin="0 10 0 0" MaxWidth="250" TextWrapping="Wrap"/>
                        <TextBlock d:Text="←操作列表 | 叠加列表→" Text="{Binding LanguageDic[Text_ToolTip_2]}" FontSize="20" HorizontalAlignment="Center" MaxWidth="250" TextWrapping="Wrap"/>
                        <TextBlock d:Text="支持PNG、GIF、SHP格式" Text="{Binding LanguageDic[Text_ToolTip_3]}" FontSize="17" HorizontalAlignment="Center" Margin="0 10 0 0" MaxWidth="250" TextWrapping="Wrap"/>
                        <TextBlock d:Text="SHP是以转成图片加载进来" Text="{Binding LanguageDic[Text_ToolTip_4]}" FontSize="17" HorizontalAlignment="Center" Margin="0 10 0 0" MaxWidth="250" TextWrapping="Wrap"/>
                        <TextBlock d:Text="需要提前选择好原本色盘" Text="{Binding LanguageDic[Text_ToolTip_5]}" FontSize="17" HorizontalAlignment="Center" Margin="0 0 0 0" MaxWidth="250" TextWrapping="Wrap"/>
                        <TextBlock d:Text="双击列表项可显示和调整图片" Text="{Binding LanguageDic[Text_ToolTip_6]}" FontSize="18" HorizontalAlignment="Center" Margin="0 10 0 0" MaxWidth="250" TextWrapping="Wrap"/>
                    </StackPanel>

                    <Grid Grid.Row="1" Grid.Column="0" Height="30" Width="260" IsEnabled="{Binding UIEnable}">
                        <StackPanel Orientation="Horizontal" VerticalAlignment="Top">
                            <Button Tag="EditList" Width="130" Height="30" Click="Button_PasteToListEnd_Click" AllowDrop="True" Drop="Img_DropToEnd">
                                <Viewbox>
                                    <TextBlock d:Text="拖放/粘贴到末尾" Text="{Binding LanguageDic[Btn_DropPasteToEnd]}"/>
                                </Viewbox>
                            </Button>
                            <Button Tag="OverlayList" Width="130" Height="30" Click="Button_PasteToListEnd_Click" AllowDrop="True" Drop="Img_DropToEnd">
                                <Viewbox>
                                    <TextBlock d:Text="拖放/粘贴到末尾" Text="{Binding LanguageDic[Btn_DropPasteToEnd]}" Margin="0 0 0 0"/>
                                </Viewbox>
                            </Button>
                        </StackPanel>
                    </Grid>
                </Grid>
            </Viewbox>

            <!--图片显示和功能区-->
            <Grid Grid.Row="0" Grid.Column="1" Margin="5 0 0 0">
                <Grid.RowDefinitions>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="auto"/>
                    <RowDefinition Height="auto"/>
                    <RowDefinition Height="0.45*" MaxHeight="280"/>
                </Grid.RowDefinitions>

                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!--图片预览窗口-->
                <Grid Grid.Row="0" Grid.Column="0" >
                    <Border x:Name="Border_ImgView" VerticalAlignment="Stretch" HorizontalAlignment="Stretch" BorderThickness="1" BorderBrush="Gray" Margin="0 0 0 0">
                        <ScrollViewer x:Name="ScrollViewer_ImgView" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Auto" PreviewMouseWheel="Grid_ImgView_PreviewMouseWheel">
                            <Grid x:Name="Grid_ImgView" HorizontalAlignment="Center" VerticalAlignment="Center"  Background="{Binding ViewBackground}">
                                <Grid.LayoutTransform>
                                    <ScaleTransform ScaleX="{Binding ImageViewScaleTransform}" ScaleY="{Binding ImageViewScaleTransform}"/>
                                </Grid.LayoutTransform>

                                <Grid x:Name="Grid_InImg" HorizontalAlignment="Left" VerticalAlignment="Top">
                                    <Image x:Name="Image_input"
                                         RenderOptions.BitmapScalingMode="NearestNeighbor"
                                         RenderOptions.ClearTypeHint="Enabled"
                                         Stretch="None"
                                         HorizontalAlignment="Left" VerticalAlignment="Top"
                                         PreviewMouseMove="Image_ViewImg_MouseMove"
                                         PreviewMouseDown="Image_input_MouseDown"
                                         PreviewMouseUp="Image_input_MouseUp"
                                     />
                                </Grid>

                                <Grid x:Name="Grid_OutImg" HorizontalAlignment="Left" VerticalAlignment="Top" Visibility="Hidden">
                                    <Image x:Name="Image_output"
                                         RenderOptions.BitmapScalingMode="NearestNeighbor"
                                         RenderOptions.ClearTypeHint="Enabled"
                                         Stretch="None"
                                         HorizontalAlignment="Left" VerticalAlignment="Top"
                                         PreviewMouseMove="Image_ViewImg_MouseMove"
                                     />
                                </Grid>

                                <Grid x:Name="Grid_OutImgOverlay" HorizontalAlignment="Left" VerticalAlignment="Top" Visibility="Visible" IsHitTestVisible="False" d:Margin="0 0 0 0" Margin="{Binding OverlayUI.OverlayGridThickness, Mode=OneWay, UpdateSourceTrigger=PropertyChanged}">
                                    <Image x:Name="Image_outputOverlay"
                                         RenderOptions.BitmapScalingMode="NearestNeighbor"
                                         RenderOptions.ClearTypeHint="Enabled"
                                         Stretch="None"
                                         HorizontalAlignment="Left"
                                         VerticalAlignment="Top"
                                     />
                                </Grid>

                                <Grid x:Name="Grid_PaletteImg" HorizontalAlignment="Left" VerticalAlignment="Top" Visibility="Hidden" d:Margin="0 0 0 0">
                                    <Image x:Name="Image_PaletteImg"
                                         RenderOptions.BitmapScalingMode="NearestNeighbor"
                                         RenderOptions.ClearTypeHint="Enabled"
                                         Stretch="None"
                                         HorizontalAlignment="Left"
                                         VerticalAlignment="Top"
                                         PreviewMouseMove="Image_ViewImg_MouseMove"
                                         PreviewMouseRightButtonDown="Image_PaletteImg_MouseRightButtonDown">

                                        <Image.ContextMenu>
                                            <ContextMenu x:Name="Image_PaletteImgContextMenu" MinWidth="160" FontSize="15" VerticalAlignment="Top" HorizontalAlignment="Left" Closed="Image_PaletteImgContextMenu_Closed">
                                                <MenuItem d:Header="禁用所选色号" Header="{Binding LanguageDic[Btn_DisableSelectedColor]}" Click="Button_PletteIndexDisable_Click"/>
                                                <MenuItem d:Header="透明所选色号" Header="{Binding LanguageDic[Btn_TransparentSelectedColor]}" Click="Button_PletteIndexTransparent_Click"/>
                                            </ContextMenu>
                                        </Image.ContextMenu>
                                    </Image>
                                </Grid>

                                <Grid x:Name="Grid_Ra2Grids" Width="0" Height="0" HorizontalAlignment="Left" VerticalAlignment="Top" Visibility="Collapsed" IsHitTestVisible="False">
                                    <Grid HorizontalAlignment="Left" VerticalAlignment="Top" Height="4000" Width="4000">
                                        <Grid x:Name="Grid_Ra2Grids_Grid" HorizontalAlignment="Left" VerticalAlignment="Top" Height="4000" Width="4000" Margin="0 0 0 0">
                                            <Grid.RenderTransform>
                                                <ScaleTransform ScaleX="1" ScaleY="0.5"/>
                                            </Grid.RenderTransform>
                                        </Grid>
                                    </Grid>
                                </Grid>
                            </Grid>
                        </ScrollViewer>
                    </Border>

                    <Viewbox VerticalAlignment="Bottom" HorizontalAlignment="Right" Margin="0 0 18 18" MaxWidth="258">
                        <StackPanel Orientation="Horizontal" Background="White" IsHitTestVisible="False">
                            <TextBlock Text="["/>
                            <TextBlock d:Text="坐标" Text="{Binding LanguageDic[Text_ImagePreview_Point]}"/>
                            <TextBlock Text="X: " Margin="5 0 0 0"/>
                            <TextBlock Text="{Binding ViewImagePointX}" Margin="5 0 0 0" Width="40"/>
                            <TextBlock Text="Y: " Margin="5 0 0 0"/>
                            <TextBlock Text="{Binding ViewImagePointY}" Margin="5 0 0 0" Width="40"/>
                            <TextBlock d:Text="色盘" Text="{Binding LanguageDic[Text_ImagePreview_Palette]}" Margin="5 0 0 0"/>
                            <TextBlock Text=": "/>
                            <TextBlock Text="{Binding ViewImagePointPaletteIndex}" Margin="5 0 0 0" Width="30"/>
                            <TextBlock Text="]"/>
                        </StackPanel>
                    </Viewbox>
                </Grid>

                <!--显示设置-->
                <Viewbox Grid.Row="1" Grid.Column="0" HorizontalAlignment="Center" MaxWidth="650" Margin="0 5 0 0">
                    <StackPanel Orientation="Horizontal">
                        <Border BorderThickness="1" BorderBrush="Gray" Width="260">
                            <Viewbox>
                                <StackPanel Orientation="Horizontal" Margin="0 0 5 0">
                                    <TextBlock d:Text="显示模式" Text="{Binding LanguageDic[Text_PreviewMode]}"/>
                                    <StackPanel Orientation="Horizontal">
                                        <RadioButton x:Name="RadioButton_ViewMode_InImg" d:Content="原图" Content="{Binding LanguageDic[Rb_PreviewMode_Original]}" Margin="5 1 0 0" IsChecked="True" Checked="RadioButton_ViewModeChanged"/>
                                        <RadioButton x:Name="RadioButton_ViewMode_OutImg" d:Content="仿色后" Content="{Binding LanguageDic[Rb_PreviewMode_Dither]}" Margin="5 1 0 0" Checked="RadioButton_ViewModeChanged"/>
                                        <RadioButton x:Name="RadioButton_ViewMode_OutImgOnPalette" d:Content="色盘下" Content="{Binding LanguageDic[Rb_PreviewMode_Palette]}" Margin="5 1 0 0" Checked="RadioButton_ViewModeChanged"/>
                                    </StackPanel>
                                </StackPanel>
                            </Viewbox>
                        </Border>

                        <Border BorderThickness="1" BorderBrush="Gray" Width="220" Margin="5 0 0 0">
                            <Viewbox>
                                <StackPanel Orientation="Horizontal" Margin="0 0 5 0" Background="Transparent">
                                    <StackPanel.ToolTip>
                                        <ToolTip Background="LightYellow">
                                            <TextBlock d:Text="art.ini/artmd.ini中的透明度数值设置预览。不影响导出图片和生成色盘，实际效果需要在art/artmd.ini中的Translucency调整" Text="{Binding LanguageDic[Text_ArtTranslucencyTip]}" TextWrapping="Wrap" Width="215"/>
                                        </ToolTip>
                                    </StackPanel.ToolTip>

                                    <TextBlock d:Text="透明度" Text="{Binding LanguageDic[Text_ArtTranslucency]}"/>
                                    <StackPanel Orientation="Horizontal">
                                        <RadioButton x:Name="RadioButton_ArtTranslucency_none" d:Content="无" Content="{Binding LanguageDic[Rb_ArtTranslucency_None]}" Margin="5 1 0 0" IsChecked="True" Checked="RadioButton_ArtTranslucencyChanged"/>
                                        <RadioButton x:Name="RadioButton_ArtTranslucency_25" Content="25" Margin="5 1 0 0" Checked="RadioButton_ArtTranslucencyChanged"/>
                                        <RadioButton x:Name="RadioButton_ArtTranslucency_50" Content="50" Margin="5 1 0 0" Checked="RadioButton_ArtTranslucencyChanged"/>
                                        <RadioButton x:Name="RadioButton_ArtTranslucency_75" Content="75" Margin="5 1 0 0" Checked="RadioButton_ArtTranslucencyChanged"/>
                                    </StackPanel>
                                </StackPanel>
                            </Viewbox>
                        </Border>

                        <StackPanel Orientation="Horizontal" Margin="10 0 0 0" Background="Transparent">
                            <StackPanel.ToolTip>
                                <ToolTip Background="LightYellow">
                                    <TextBlock d:Text="预览窗口中Ctrl+鼠标滚轮进行缩放" Text="{Binding LanguageDic[Text_PreviewScaleTip]}" TextWrapping="Wrap" Width="160"/>
                                </ToolTip>
                            </StackPanel.ToolTip>

                            <TextBlock d:Text="预览缩放" Text="{Binding LanguageDic[Text_PreviewScale]}"/>
                            <TextBlock d:Text="100%" Text="{Binding ImageViewScaleTransformStr}" Margin="5 0 0 0"/>
                        </StackPanel>
                    </StackPanel>
                </Viewbox>

                <!--播放-预览-->
                <Viewbox Grid.Row="2" Grid.Column="0" HorizontalAlignment="Center" MaxWidth="650" Margin="0 8 0 0">
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock d:Text="当前序号:" Text="{Binding LanguageDic[Text_NowImageIndex]}" FontSize="16"/>
                            <TextBlock d:Text="00000" x:Name="TextBlock_NowIndex" Text="{Binding IndexStr, Mode=OneWay, UpdateSourceTrigger=PropertyChanged}"  FontSize="16" Width="50" Margin="10 0 0 0"/>
                        </StackPanel>

                        <Button d:Content="预览背景色/图片" Content="{Binding LanguageDic[Btn_PreviewBackground]}" Height="25" AllowDrop="True" Drop="SetBackgroundImage" Click="SelectViewBackgroundColor_Click" Margin="5 0 0 0" VerticalAlignment="Top" HorizontalAlignment="Left"/>

                        <StackPanel Orientation="Horizontal" Margin="20 0 0 0" >
                            <Button x:Name="Button_PreviousFrame" VerticalAlignment="Top" Height="25" Width="12" Click="Button_PreviousFrame_Click" IsEnabled="{Binding UIEnable}">
                                <Path Stretch="Fill" Fill="Black" Data="M630.4 41.6l-416 428.8c-6.4 9.6-9.6 19.2-9.6 28.8 0 9.6 3.2 22.4 9.6 28.8l416 428.8c12.8 16 35.2 16 48 0 12.8-16 12.8-41.6 0-54.4L288 499.2 678.4 96c12.8-16 12.8-41.6 0-54.4-12.8-16-35.2-16-48 0z"/>
                            </Button>

                            <Button x:Name="Button_Play" d:Content="播放" Content="{Binding LanguageDic[Btn_Play]}" Width="40" Height="25" Margin="5 0 0 0" Click="Button_Play_Click" VerticalAlignment="Top" HorizontalAlignment="Left"/>

                            <Button x:Name="Button_NextFrame" VerticalAlignment="Top" Height="25" Width="12" Margin="5 0 0 0" Click="Button_NextFrame_Click" IsEnabled="{Binding UIEnable}">
                                <Path Stretch="Fill" Fill="Black" Data="M329.6 969.6l416-428.8c6.4-9.6 9.6-19.2 9.6-28.8 0-9.6-3.2-22.4-9.6-28.8l-416-428.8c-12.8-16-35.2-16-48 0s-16 41.6 0 54.4L668.8 512 281.6 915.2c-12.8 16-12.8 41.6 0 54.4 12.8 16 35.2 16 48 0z"/>
                            </Button>
                        </StackPanel>

                        <StackPanel Orientation="Horizontal" Margin="10 0 0 0" Background="Transparent">
                            <StackPanel.ToolTip>
                                <ToolTip Background="LightYellow">
                                    <TextBlock Text="颜色和游戏中可能存在差别，仅作为参考"/>
                                </ToolTip>
                            </StackPanel.ToolTip>
                            <TextBlock d:Text="预览所属色" Text="{Binding LanguageDic[Text_PreviewPlayerColor]}" Margin="0 3 0 0"/>
                            <ComboBox x:Name="ComboBox_PlayerColorPreview" Width="84" Height="25" VerticalAlignment="Top" Margin="5 0 0 0" DisplayMemberPath="DisplayName" SelectedValuePath="Value" SelectionChanged="ComboBox_PlayerColorView_Changed"/>
                        </StackPanel>

                        <StackPanel Orientation="Horizontal" Margin="10 0 0 0" >
                            <CheckBox x:Name="CheckBox_Ra2Grids" d:Content="网格" Content="{Binding LanguageDic[Cb_PreviewGrid]}" Margin="0 5 0 0" Checked="CheckBox_Ra2Grids_Changed" Unchecked="CheckBox_Ra2Grids_Changed"/>
                            <Button x:Name="Button_SetRa2GridsColor" Background="Black" Height="20" Width="20" Margin="2 0 0 0" Click="Button_SetRa2GridsColor_Click"/>
                        </StackPanel>
                    </StackPanel>
                </Viewbox>

                <!--下方功能栏-->
                <Viewbox Grid.Row="3" Grid.Column="0" Margin="0 10 0 0">
                    <TabControl x:Name="TabControl_Tools" IsEnabled="{Binding UIEnable}" Width="620" Height="210" HorizontalAlignment="Stretch" VerticalAlignment="Stretch">
                        <!--裁剪缩放-->
                        <TabItem d:Header="裁剪/缩放" Header="{Binding LanguageDic[Tc_CutResize]}" MinWidth="80">
                            <StackPanel Orientation="Horizontal">
                                <!--缩放-->
                                <GroupBox d:Header="缩放" Header="{Binding LanguageDic[Text_Resize]}" MinWidth="185" Height="180" HorizontalAlignment="Left" VerticalAlignment="Top">
                                    <StackPanel Margin="10 0 0 0">
                                        <StackPanel Orientation="Horizontal">
                                            <StackPanel>
                                                <TextBlock d:Text="宽度" Text="{Binding LanguageDic[Text_Resize_Width]}" HorizontalAlignment="Left" VerticalAlignment="Top"/>
                                                <TextBox Text="{Binding ResizeUI.ImageNowWidthStr, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Width="60" Height="21" Padding="0 0 0 0" HorizontalAlignment="Left" VerticalAlignment="Top"/>
                                            </StackPanel>

                                            <StackPanel Margin="30 0 0 0">
                                                <TextBlock d:Text="高度" Text="{Binding LanguageDic[Text_Resize_Height]}" HorizontalAlignment="Left" VerticalAlignment="Top"/>
                                                <TextBox Text="{Binding ResizeUI.ImageNowHeightStr, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Width="60" Height="21" Padding="0 0 0 0" HorizontalAlignment="Left" VerticalAlignment="Top"/>
                                            </StackPanel>
                                        </StackPanel>
                                        
                                        <StackPanel Orientation="Horizontal">
                                            <StackPanel>
                                                <TextBlock d:Text="宽度%" Text="{Binding LanguageDic[Text_Resize_Width]}" HorizontalAlignment="Left" VerticalAlignment="Top"/>
                                                <TextBox Text="{Binding ResizeUI.ImageNowWidthPercentageStr, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Width="60" Height="21" Padding="0 0 0 0" HorizontalAlignment="Left" VerticalAlignment="Top"/>
                                            </StackPanel>

                                            <StackPanel Margin="30 0 0 0">
                                                <TextBlock d:Text="高度%" Text="{Binding LanguageDic[Text_Resize_Height1]}" HorizontalAlignment="Left" VerticalAlignment="Top"/>
                                                <TextBox Text="{Binding ResizeUI.ImageNowHeightPercentageStr, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Width="60" Height="21" Padding="0 0 0 0" HorizontalAlignment="Left" VerticalAlignment="Top"/>
                                            </StackPanel>
                                        </StackPanel>

                                        <CheckBox d:Content="保持高宽比" Content="{Binding LanguageDic[Text_Resize_MaintainAspectRatio]}" Margin="0 5 0 0" IsChecked="{Binding ResizeUI.ResizeMaintainAspectRatio}"/>
                                        <TextBlock d:Text="操作会取消画布调整" Text="{Binding LanguageDic[Text_Resize_Tip]}" FontSize="14" TextWrapping="Wrap" Margin="0 0 0 0"/>

                                        <StackPanel Orientation="Horizontal" Margin="0 5 0 0">
                                            <Button d:Content="还原" Content="{Binding LanguageDic[Btn_Resize_Restore]}" MinWidth="50" Click="Button_CancelResize_Click"/>
                                            <Button d:Content="应用" Content="{Binding LanguageDic[Btn_Resize_Apply]}" MinWidth="50" Margin="50 0 0 0" Click="Button_Resize_Click"/>
                                        </StackPanel>
                                    </StackPanel>
                                </GroupBox>

                                <StackPanel Margin="10 65 0 0" VerticalAlignment="Top" Background="Transparent">
                                    <StackPanel.ToolTip>
                                        <ToolTip Background="LightYellow">
                                            <TextBlock d:Text="调整缩放和画布会取消透明仿色效果，调整缩放会取消画布调整，应按照 缩放-画布调整-透明仿色 的顺序进行" Text="{Binding LanguageDic[Text_CutResizeTip]}" TextWrapping="Wrap" Width="225"/>
                                        </ToolTip>
                                    </StackPanel.ToolTip>

                                    <Path Width="60" Height="40" Fill="Black" Stretch="Fill" Data="M545.3 407.1h-421c-14.5 0-26.3 11.8-26.3 26.3v155.2c0 14.5 11.8 26.3 26.3 26.3h421V721c0 10.2 11.1 16.5 19.8 11.4l356.4-209c8.7-5.1 8.7-17.6 0-22.7l-356.4-209c-8.8-5.2-19.8 1.2-19.8 11.4v104zM598 651.9v-89.6H150.7V459.8H598v-87.6L848.7 512 598 651.9z"/>
                                </StackPanel>

                                <!--画布调整-->
                                <GroupBox d:Header="画布调整" Header="{Binding LanguageDic[Text_Edit_Canvas]}" Margin="10 0 0 0" MinWidth="210" Height="180" HorizontalAlignment="Left" VerticalAlignment="Top">
                                    <Grid Margin="10 0 0 0">
                                        <StackPanel>
                                            <StackPanel Margin="60 0 0 0">
                                                <TextBlock d:Text="顶部" Text="{Binding LanguageDic[Text_Canvas_Top]}" HorizontalAlignment="Left" VerticalAlignment="Top" Margin="5 0 0 0"/>
                                                <TextBox Text="{Binding ResizeUI.ReMarginTop, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Width="60" Height="21" Padding="0 0 0 0" HorizontalAlignment="Left" VerticalAlignment="Top"/>
                                            </StackPanel>

                                            <StackPanel Orientation="Horizontal" Margin="0 -15 0 0">
                                                <StackPanel>
                                                    <TextBlock d:Text="左侧" Text="{Binding LanguageDic[Text_Canvas_Left]}" HorizontalAlignment="Left" VerticalAlignment="Top" Margin="5 0 0 0"/>
                                                    <TextBox Text="{Binding ResizeUI.ReMarginLeft, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Width="60" Height="21" Padding="0 0 0 0" HorizontalAlignment="Left" VerticalAlignment="Top"/>
                                                </StackPanel>

                                                <StackPanel Margin="60 0 0 0">
                                                    <TextBlock d:Text="右侧" Text="{Binding LanguageDic[Text_Canvas_Right]}" HorizontalAlignment="Left" VerticalAlignment="Top" Margin="5 0 0 0"/>
                                                    <TextBox Text="{Binding ResizeUI.ReMarginRight, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Width="60" Height="21" Padding="0 0 0 0" HorizontalAlignment="Left" VerticalAlignment="Top"/>
                                                </StackPanel>
                                            </StackPanel>

                                            <StackPanel Margin="60 -15 0 0">
                                                <TextBlock d:Text="底部" Text="{Binding LanguageDic[Text_Canvas_Bottom]}" HorizontalAlignment="Left" VerticalAlignment="Top" Margin="5 0 0 0"/>
                                                <TextBox Text="{Binding ResizeUI.ReMarginBottom, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Width="60" Height="21" Padding="0 0 0 0" HorizontalAlignment="Left" VerticalAlignment="Top"/>
                                            </StackPanel>

                                            <CheckBox d:Content="调整后优化画布尺寸" Content="{Binding LanguageDic[Text_Canvas_AutoCut]}" IsChecked="{Binding ResizeUI.ReMarginCutImage}" Margin="0 5 0 0"/>

                                            <StackPanel Orientation="Horizontal" Margin="0 5 0 0">
                                                <Button d:Content="还原到缩放" Content="{Binding LanguageDic[Btn_Canvas_RestoreToResize]}" Click="Button_CancelReMargin_Click"/>
                                                <Button d:Content="应用" Content="{Binding LanguageDic[Btn_Canvas_Apply]}" Width="60" Margin="40 0 0 0" Click="Button_ReMargin_Click"/>
                                            </StackPanel>
                                        </StackPanel>

                                        <Button x:Name="Button_ReMarginOnImage" d:Content="拖动设置" Content="{Binding LanguageDic[Text_Edit_Canvas_DragToEdit]}" Width="58" Height="20" FontSize="13" VerticalAlignment="Top" HorizontalAlignment="Left" Margin="-5 3 0 0" Click="Button_ReMarginOnImage_Click">
                                            <Button.ToolTip>
                                                <ToolTip Background="LightYellow">
                                                    <TextBlock d:Text="在原图显示模式下，鼠标左键拖动来调整" Text="{Binding LanguageDic[Text_Edit_Canvas_DragToEditTip]}"/>
                                                </ToolTip>
                                            </Button.ToolTip>
                                        </Button>
                                    </Grid>
                                </GroupBox>
                            </StackPanel>
                        </TabItem>

                        <TabItem d:Header="透明仿色" Header="{Binding LanguageDic[Tc_Dither]}" MinWidth="80">
                            <Grid Margin="10 10 0 0">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="auto"/>
                                    <RowDefinition Height="auto"/>
                                    <RowDefinition Height="auto"/>
                                    <RowDefinition Height="auto"/>
                                    <RowDefinition Height="auto"/>
                                </Grid.RowDefinitions>

                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <CheckBox Grid.Row="0" x:Name="CheckBox_OutlineTransparent" d:Content="按轮廓透明过渡(对不带透明过渡图片使用的)" Content="{Binding LanguageDic[Rb_Dither_OutlineTransparent]}" IsChecked="{Binding DitherUI.IsTransparent, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Checked="CheckBox_OutlineTransparent_Changed" Unchecked="CheckBox_OutlineTransparent_Changed"/>

                                <Grid Grid.Row="1" Grid.Column="0" Margin="0 12 0 0">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="80"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="120"/>
                                    </Grid.ColumnDefinitions>

                                    <TextBlock Grid.Column="0" d:Text="透明度扩散" Text="{Binding LanguageDic[Text_Dither_TransparentDiffusion]}" Width="90" HorizontalAlignment="Left"/>
                                    <Slider x:Name="Slider_TransparentDiffusion"
                                        Grid.Column="1"
                                        Width="390"
                                        Minimum="0.01"
                                        Maximum="1.5"
                                        TickFrequency="0.01"
                                        Value="{Binding DitherUI.TransparentDiffusion ,Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                        IsSnapToTickEnabled="True"
                                        Margin="5 0 0 0"
                                        PreviewMouseUp="Slider_MouseUp"
                                />

                                    <StackPanel Grid.Column="2" Orientation="Horizontal" HorizontalAlignment="Left">
                                        <Button Tag="-0.1"  Width="15" Height="15" Background="Transparent" BorderThickness="0" Click="Button_ChangeTransparentDiffusion_Click">
                                            <Path Fill="Black" Stretch="Fill" Data="M500.970806 776.449951l0-528.901948-374.624213 264.465301L500.970806 776.449951zM523.030218 512.014326l374.622166 264.436648 0-528.901948L523.030218 512.014326z"/>
                                        </Button>

                                        <Button Tag="-0.01" Width="10" Height="15" Background="Transparent" BorderThickness="0" Margin="5 0 0 0" Click="Button_ChangeTransparentDiffusion_Click">
                                            <Path Fill="Black" Stretch="Fill" Data="M640 768L384 512l256-256z"/>
                                        </Button>

                                        <TextBlock x:Name="TextBlock_TransparentDiffusion" d:Text="0.50" Text="{Binding DitherUI.TransparentDiffusionStr, Mode=OneWay, UpdateSourceTrigger=PropertyChanged}" TextAlignment="Center" HorizontalAlignment="Left" Width="40" Margin="5 0 0 0"/>

                                        <Button Tag="0.01" Width="10" Height="15" Background="Transparent" BorderThickness="0" Margin="5 0 0 0" Click="Button_ChangeTransparentDiffusion_Click">
                                            <Path Fill="Black" Stretch="Fill" Data="M384 256l256 256-256 256z"/>
                                        </Button>

                                        <Button Tag="0.1" Width="15" Height="15" Background="Transparent" BorderThickness="0" Margin="5 0 0 0" Click="Button_ChangeTransparentDiffusion_Click">
                                            <Path Fill="Black" Stretch="Fill" Data="M895.604748 512.014326l-374.624213-264.465301 0 528.901948L895.604748 512.014326zM124.298957 247.549026l0 528.901948 374.622166-264.436648L124.298957 247.549026z"/>
                                        </Button>
                                    </StackPanel>
                                </Grid>

                                <Grid Grid.Row="2" Margin="0 12 0 0">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="80"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="120"/>
                                    </Grid.ColumnDefinitions>

                                    <TextBlock Grid.Column="0" d:Text="边缘明暗度" Text="{Binding LanguageDic[Text_Dither_Lightness]}" Width="90" HorizontalAlignment="Left"/>
                                    <Slider x:Name="Slider_Lightness"
                                        Grid.Column="1"
                                        Width="390"
                                        Minimum="-1.0"
                                        Maximum="1.0"
                                        TickFrequency="0.01"
                                        Value="{Binding DitherUI.Lightness, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                        IsSnapToTickEnabled="True"
                                        Margin="5 0 0 0"
                                        PreviewMouseUp="Slider_MouseUp"
                                />

                                    <StackPanel Grid.Column="2" Orientation="Horizontal" HorizontalAlignment="Left">
                                        <Button Tag="-0.1"  Width="15" Height="15" Background="Transparent" BorderThickness="0" Click="Button_ChangeLightness_Click">
                                            <Path Fill="Black" Stretch="Fill" Data="M500.970806 776.449951l0-528.901948-374.624213 264.465301L500.970806 776.449951zM523.030218 512.014326l374.622166 264.436648 0-528.901948L523.030218 512.014326z"/>
                                        </Button>

                                        <Button Tag="-0.01" Width="10" Height="15" Background="Transparent" BorderThickness="0" Margin="5 0 0 0" Click="Button_ChangeLightness_Click">
                                            <Path Fill="Black" Stretch="Fill" Data="M640 768L384 512l256-256z"/>
                                        </Button>

                                        <TextBlock x:Name="TextBlock_Lightness" d:Text="0.00" Text="{Binding DitherUI.LightnessStr, Mode=OneWay, UpdateSourceTrigger=PropertyChanged}" TextAlignment="Center" HorizontalAlignment="Left" Width="40" Margin="5 0 0 0"/>

                                        <Button Tag="0.01" Width="10" Height="15" Background="Transparent" BorderThickness="0" Margin="5 0 0 0" Click="Button_ChangeLightness_Click">
                                            <Path Fill="Black" Stretch="Fill" Data="M384 256l256 256-256 256z"/>
                                        </Button>

                                        <Button Tag="0.1" Width="15" Height="15" Background="Transparent" BorderThickness="0" Margin="5 0 0 0" Click="Button_ChangeLightness_Click">
                                            <Path Fill="Black" Stretch="Fill" Data="M895.604748 512.014326l-374.624213-264.465301 0 528.901948L895.604748 512.014326zM124.298957 247.549026l0 528.901948 374.622166-264.436648L124.298957 247.549026z"/>
                                        </Button>
                                    </StackPanel>
                                </Grid>

                                <Grid Grid.Row="3" Margin="0 12 0 0">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="80"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="120"/>
                                    </Grid.ColumnDefinitions>

                                    <TextBlock Grid.Column="0" d:Text="整体透明度" Text="{Binding LanguageDic[Text_Dither_Alpha]}" Width="90" HorizontalAlignment="Left"/>
                                    <Slider x:Name="Slider_Alpha"
                                        Grid.Column="1"
                                        Width="390"
                                        Minimum="-255"
                                        Maximum="255"
                                        TickFrequency="1"
                                        Value="{Binding DitherUI.Alpha, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                        IsSnapToTickEnabled="True"
                                        Margin="5 0 0 0"
                                        PreviewMouseUp="Slider_MouseUp"
                                />

                                    <StackPanel Grid.Column="2" Orientation="Horizontal" HorizontalAlignment="Left">
                                        <Button Tag="-10"  Width="15" Height="15" Background="Transparent" BorderThickness="0" Click="Button_ChangeAlpha_Click">
                                            <Path Fill="Black" Stretch="Fill" Data="M500.970806 776.449951l0-528.901948-374.624213 264.465301L500.970806 776.449951zM523.030218 512.014326l374.622166 264.436648 0-528.901948L523.030218 512.014326z"/>
                                        </Button>

                                        <Button Tag="-1" Width="10" Height="15" Background="Transparent" BorderThickness="0" Margin="5 0 0 0" Click="Button_ChangeAlpha_Click">
                                            <Path Fill="Black" Stretch="Fill" Data="M640 768L384 512l256-256z"/>
                                        </Button>

                                        <TextBlock x:Name="TextBlock_Alpha" d:Text="100" Text="{Binding DitherUI.Alpha, Mode=OneWay, UpdateSourceTrigger=PropertyChanged}" TextAlignment="Center" HorizontalAlignment="Left" Width="40" Margin="5 0 0 0"/>

                                        <Button Tag="1" Width="10" Height="15" Background="Transparent" BorderThickness="0" Margin="5 0 0 0" Click="Button_ChangeAlpha_Click">
                                            <Path Fill="Black" Stretch="Fill" Data="M384 256l256 256-256 256z"/>
                                        </Button>

                                        <Button Tag="10" Width="15" Height="15" Background="Transparent" BorderThickness="0" Margin="5 0 0 0" Click="Button_ChangeAlpha_Click">
                                            <Path Fill="Black" Stretch="Fill" Data="M895.604748 512.014326l-374.624213-264.465301 0 528.901948L895.604748 512.014326zM124.298957 247.549026l0 528.901948 374.622166-264.436648L124.298957 247.549026z"/>
                                        </Button>
                                    </StackPanel>
                                </Grid>

                                <StackPanel Grid.Row="4" Orientation="Horizontal" Margin="0 15 0 0">
                                    <Button d:Content="重置所有图像" Content="{Binding LanguageDic[Btn_Dither_RestoreAllImage]}" Height="30" Margin="0 0 0 0" Click="Button_ResetAll_Click"/>
                                    <Button d:Content="重置当前图像" Content="{Binding LanguageDic[Btn_Dither_RestoreThisImage]}" Height="30" Margin="60 0 0 0" Click="Button_ResetNowIndex_Click"/>
                                    <Button x:Name="Button_Test" Content="测试载入" d:Visibility="Visible" Visibility="Hidden" Height="30" Margin="20 0 0 0" Click="Button_Test_Click"/>
                                    <Button d:Content="应用到所有图片" Content="{Binding LanguageDic[Btn_Dither_ApplyToAll]}" Margin="40 0 0 0" Click="Button_ApplyToAllImg_Click"/>
                                </StackPanel>
                            </Grid>
                        </TabItem>

                        <TabItem d:Header="图片叠加" Header="{Binding LanguageDic[Tc_ImageOverlay]}" MinWidth="80">
                            <StackPanel Orientation="Vertical" Margin="10 10 0 0" Height="150">
                                <ComboBox x:Name="ComboBox_OverlayMode" SelectedValue="{Binding OverlayUI.OverlayMode, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" DisplayMemberPath="DisplayName" SelectedValuePath="Value" Width="130" VerticalAlignment="Top" HorizontalAlignment="Left" Margin="0 0 0 0"/>

                                <StackPanel Orientation="Horizontal" Margin="0 10 0 0">
                                    <StackPanel Margin="0 0 0 0">
                                        <TextBlock d:Text="X偏移" Text="{Binding LanguageDic[Text_Overlay_XOffset]}" VerticalAlignment="Top" HorizontalAlignment="Left"/>
                                        <TextBox TextWrapping="NoWrap" Text="{Binding OverlayUI.OverlayXOffsetStr, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" PreviewTextInput="TextBox_Overlay_PreviewTextInput" Width="60" Margin="0 0 0 0" VerticalAlignment="Top" HorizontalAlignment="Left"/>
                                    </StackPanel>

                                    <StackPanel Margin="20 0 0 0">
                                        <TextBlock d:Text="Y偏移" Text="{Binding LanguageDic[Text_Overlay_YOffset]}" VerticalAlignment="Top" HorizontalAlignment="Left"/>
                                        <TextBox TextWrapping="NoWrap" Text="{Binding OverlayUI.OverlayYOffsetStr, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" PreviewTextInput="TextBox_Overlay_PreviewTextInput" Width="60" Margin="0 0 0 0" VerticalAlignment="Top" HorizontalAlignment="Left"/>
                                    </StackPanel>
                                </StackPanel>

                                <Button Height="27" d:Content="应用到所有叠加图片" Content="{Binding LanguageDic[Btn_Overlay_ApplyToAll]}" Width="auto" HorizontalAlignment="Left" Margin="0 15 0 0" Click="Button_ApplyToAllOverlayImg_Click"/>
                            </StackPanel>
                        </TabItem>

                        <TabItem Header="图片绘制" Width="80" Visibility="Collapsed">
                            <Button Click="Button_DrawImage_Click"/>
                        </TabItem>

                        <TabItem Header="色盘编辑" Width="80" Visibility="Collapsed">

                        </TabItem>

                        <TabItem d:Header="导出/生成" Header="{Binding LanguageDic[Tc_Exprot]}" MinWidth="80">
                            <StackPanel Orientation="Horizontal" Margin="10 10 0 0">
                                <GroupBox d:Header="导出全部图片" Header="{Binding LanguageDic[Text_Exprot_ExprotAllImage]}" Height="150" VerticalAlignment="Top">
                                    <StackPanel Margin="0 3 0 0">
                                        <Button d:Content="仿色后" Content="{Binding LanguageDic[Text_Exprot_Dither]}" Click="Button_ExportAllImage_Click" FontSize="16" Height="24" Width="100" Margin="0 0 0 0"/>
                                        <Button d:Content="色盘下" Content="{Binding LanguageDic[Text_Exprot_OnPalette]}" Click="Button_ExportAllPaletteImage_Click" FontSize="16" Height="24" Width="100" Margin="0 10 0 0"/>
                                        <Button Click="Button_ExportAllPaletteImageNoBackground_Click" FontSize="16" MinHeight="24" Width="100" Margin="0 10 0 0">
                                            <TextBlock d:Text="色盘下无背景" Text="{Binding LanguageDic[Text_Exprot_OnPaletteNotBackground]}" FontSize="15" TextWrapping="Wrap"/>
                                        </Button>
                                    </StackPanel>
                                </GroupBox>

                                <GroupBox d:Header="生成色盘" Header="{Binding LanguageDic[Text_CreatePalette]}" Margin="10 0 0 0" Height="165" VerticalAlignment="Top">
                                    <StackPanel Margin="0 5 0 0" HorizontalAlignment="Left">
                                        <StackPanel Orientation="Horizontal">
                                            <CheckBox x:Name="CheckBox_PlayerColor" d:Content="所属色" Content="{Binding LanguageDic[Cb_CreatePalette_PlayerColor]}" Margin="0 3 0 0" Checked="CheckBox_PlayerColor_Changed" Unchecked="CheckBox_PlayerColor_Changed"/>
                                            <Button x:Name="Button_EditPlayerColor" d:Content="所属色拾取" Content="{Binding LanguageDic[Cb_CreatePalette_SetPlayerColor]}" Margin="10 0 0 0" IsEnabled="False" Click="Button_EditPlayerColor_Click"/>
                                        </StackPanel>

                                        <StackPanel Orientation="Horizontal" Margin="0 7 0 0" HorizontalAlignment="Left">
                                            <StackPanel.ToolTip>
                                                <ToolTip Background="LightYellow">
                                                    <TextBlock d:Text="单位和建筑16-31号为玩家所属色，240-255号色不随光照变化，不使用240-255号色可填写(240)" Text="{Binding LanguageDic[Text_CreatePalette_ColorCountTip]}" TextWrapping="Wrap" Width="230"/>
                                                </ToolTip>
                                            </StackPanel.ToolTip>
                                            <TextBlock d:Text="色盘颜色数量" Text="{Binding LanguageDic[Text_CreatePalette_ColorCount]}"/>
                                            <TextBox x:Name="TextBox_PalColorNum" Text="256" Width="40" Height="21" Padding="0 0 0 0"/>
                                        </StackPanel>

                                        <StackPanel Margin="0 5 0 0">
                                            <TextBlock d:Text="色盘背景/头部颜色" Text="{Binding LanguageDic[Text_CreatePalette_HeaderColor]}" HorizontalAlignment="Left"/>

                                            <StackPanel Orientation="Horizontal">
                                                <Grid Margin="0 0 0 0">
                                                    <StackPanel Orientation="Horizontal">
                                                        <Path Width="16" Height="16" Margin="14 0 0 0" Fill="Black" Stretch="Fill" Data="M964.794062 100.92562 923.057495 59.190077 511.999488 470.263433 100.938412 59.190077 59.203892 100.92562 470.263945 512 59.232544 923.045727 100.968088 964.78127 511.999488 553.736567 923.057495 964.8089 964.794062 923.073356 553.732985 512Z"/>
                                                        <Path Width="16" Height="16" Margin="24 0 0 0" Fill="Black" Stretch="Fill" Data="M964.794062 100.92562 923.057495 59.190077 511.999488 470.263433 100.938412 59.190077 59.203892 100.92562 470.263945 512 59.232544 923.045727 100.968088 964.78127 511.999488 553.736567 923.057495 964.8089 964.794062 923.073356 553.732985 512Z"/>
                                                        <Path Width="16" Height="16" Margin="24 0 0 0" Fill="Black" Stretch="Fill" Data="M964.794062 100.92562 923.057495 59.190077 511.999488 470.263433 100.938412 59.190077 59.203892 100.92562 470.263945 512 59.232544 923.045727 100.968088 964.78127 511.999488 553.736567 923.057495 964.8089 964.794062 923.073356 553.732985 512Z"/>
                                                    </StackPanel>

                                                    <StackPanel x:Name="StackPanel_PaletteHeaderColor" Orientation="Horizontal">
                                                        <Button Width="20" Height="20" Background="Transparent" Margin="12 0 0 0" Click="Button_SetPalHeaderColor_Click"/>
                                                        <Button Width="20" Height="20" Background="Transparent" Margin="20 0 0 0" Click="Button_SetPalHeaderColor_Click" MouseRightButtonDown="ClearPalHeaderColor"/>
                                                        <Button Width="20" Height="20" Background="Transparent" Margin="20 0 0 0" Click="Button_SetPalHeaderColor_Click" MouseRightButtonDown="ClearPalHeaderColor"/>
                                                    </StackPanel>

                                                    <StackPanel Orientation="Horizontal">
                                                        <TextBlock Text="0"/>
                                                        <TextBlock Text="1" Margin="30 0 0 0"/>
                                                        <TextBlock Text="2" Margin="30 0 0 0"/>
                                                    </StackPanel>
                                                </Grid>

                                                <StackPanel Margin="10 -15 0 0">
                                                    <TextBlock d:Text="左键设置" Text="{Binding LanguageDic[Text_CreatePalette_HeaderColorTip1]}" FontSize="14"/>
                                                    <TextBlock d:Text="右键删除" Text="{Binding LanguageDic[Text_CreatePalette_HeaderColorTip2]}" FontSize="14"/>
                                                </StackPanel>
                                            </StackPanel>
                                        </StackPanel>

                                        <StackPanel Orientation="Horizontal" Margin="0 5 0 0" HorizontalAlignment="Right">
                                            <ComboBox x:Name="ComboBox_CreatePalMode" DisplayMemberPath="DisplayName" SelectedValuePath="Value" FontSize="15" Width="160" Height="25" Margin="0 0 0 0">
                                                <ComboBox.ToolTip>
                                                    <ToolTip Background="LightYellow">
                                                        <StackPanel>
                                                            <TextBlock FontWeight="Bold" d:Text="主要颜色 (生成速度慢)：" Text="{Binding LanguageDic[Text_CreatePalette_Tip1]}"/>
                                                            <TextBlock d:Text="适用于图片颜色不是太复杂的情况" Text="{Binding LanguageDic[Text_CreatePalette_Tip2]}"/>
                                                            <TextBlock d:Text="根据图片占比最高的颜色生成，会合并几乎相同的颜色" Text="{Binding LanguageDic[Text_CreatePalette_Tip3]}"/>
                                                            <TextBlock d:Text="如有少量的其他颜色可能会被忽略" Text="{Binding LanguageDic[Text_CreatePalette_Tip4]}"/>

                                                            <TextBlock FontWeight="Bold" d:Text="主要颜色+补全 (生成速度慢)：" Margin="0 10 0 0" Text="{Binding LanguageDic[Text_CreatePalette_Tip5]}"/>
                                                            <TextBlock d:Text="适用于图片颜色不是太复杂的情况" Text="{Binding LanguageDic[Text_CreatePalette_Tip6]}"/>
                                                            <TextBlock d:Text="在[主要颜色]的基础上尽可能补全其他占比较少的颜色" Text="{Binding LanguageDic[Text_CreatePalette_Tip7]}"/>

                                                            <TextBlock FontWeight="Bold" d:Text="OctreeQuantizer (生成速度快)：" Margin="0 10 0 0" Text="{Binding LanguageDic[Text_CreatePalette_Tip8]}"/>
                                                            <TextBlock d:Text="适用于图片颜色比较复杂的情况" Text="{Binding LanguageDic[Text_CreatePalette_Tip9]}"/>
                                                            <TextBlock d:Text="八叉树颜色量化算法" Text="{Binding LanguageDic[Text_CreatePalette_Tip10]}"/>
                                                        </StackPanel>
                                                    </ToolTip>
                                                </ComboBox.ToolTip>
                                            </ComboBox>

                                            <Button x:Name="Button_CreatePal" Height="28" MinWidth="50" MaxWidth="65" Margin="10 0 0 0" HorizontalAlignment="Right" Click="Button_CreatePal_Click">
                                                <Viewbox>
                                                    <TextBlock d:Text="生成" FontSize="20" Text="{Binding LanguageDic[Btn_CreatePalette_Create]}"/>
                                                </Viewbox>
                                            </Button>
                                        </StackPanel>
                                    </StackPanel>
                                </GroupBox>

                                <GroupBox d:Header="生成SHP" Header="{Binding LanguageDic[Text_CreateShp]}" Margin="10 0 0 0" Height="165" Width="200" VerticalAlignment="Top">
                                    <StackPanel Margin="0 5 0 0" HorizontalAlignment="Left">
                                        <TextBlock d:Text="储存模式" Text="{Binding LanguageDic[Text_CreateShp_SaveMode]}"/>
                                        <ComboBox x:Name="ComboBox_ShpSaveMode" DisplayMemberPath="DisplayName" SelectedValuePath="Value" FontSize="15" Width="150" Height="25" HorizontalAlignment="Left" Margin="0 0 0 0"/>
                                        <CheckBox x:Name="CheckBox_ShpShadow" d:Content="影子帧" Content="{Binding LanguageDic[Cb_CreateShp_ShadowFrame]}" Margin="0 7 0 0"/>
                                        <StackPanel Orientation="Horizontal">
                                            <TextBox x:Name="TextBox_ShpShadowFrameStart" Width="42" Height="21" Padding="0 0 0 0"/>
                                            <TextBlock Text="~"/>
                                            <TextBox x:Name="TextBox_ShpShadowFrameEnd" Width="42" Height="21" Padding="0 0 0 0"/>
                                            <Button d:Content="列表后半" Content="{Binding LanguageDic[Btn_CreateShp_ShadowFrameLatterPartOfList]}" Margin="5 0 0 0" FontSize="14" Click="Button_ShpShadowFrameAutoSet_Click"/>
                                        </StackPanel>

                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock d:Text="影子帧绘制为1号色" Text="{Binding LanguageDic[Cb_CreateShp_ShadowFrameTip]}" TextWrapping="Wrap" Width="120" FontSize="14" HorizontalAlignment="Left" Margin="0 5 0 0"/>
                                            <Button x:Name="Button_CreateShp" Height="28" MinWidth="50" MaxWidth="65" Margin="0 10 0 0" HorizontalAlignment="Right" Click="Button_CreateShp_Click">
                                                <Viewbox>
                                                    <TextBlock d:Text="生成" FontSize="20" Text="{Binding LanguageDic[Btn_CreateShp_CreateShp]}"/>
                                                </Viewbox>
                                            </Button>
                                        </StackPanel>
                                    </StackPanel>
                                </GroupBox>
                            </StackPanel>
                        </TabItem>
                    </TabControl>
                </Viewbox>
            </Grid>

            <!--色盘预览-->
            <Grid Grid.Row="0" Grid.Column="2" Margin="7 -5 0 0" IsEnabled="{Binding UIEnable}">
                <Grid.RowDefinitions>
                    <RowDefinition Height="auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="auto"/>
                    <RowDefinition Height="0.1*"/>
                    <RowDefinition Height="0.05*"/>
                </Grid.RowDefinitions>

                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <Viewbox Grid.Row="0" MaxHeight="35" HorizontalAlignment="Left" MaxWidth="160">
                    <ComboBox x:Name="ComboBox_Palette" Width="150" Height="25" HorizontalAlignment="Left" SelectionChanged="ComboBox_Palette_SelectionChanged" Margin="0 5 0 0"/>
                </Viewbox>

                <Viewbox Grid.Row="1" Stretch="Fill" Margin="0 5 0 0">
                    <DataGrid x:Name="DataGrid_Palette"
                        Width="224"
                        Height="580"
                        RowHeight="18"
                        CanUserAddRows="False"
                        AutoGenerateColumns="False"
                        SelectionMode="Extended"
                        SelectionUnit="Cell"
                        HeadersVisibility="None"
                        IsReadOnly="True"
                        ColumnWidth="Auto"
                        CanUserResizeRows="False"
                        GridLinesVisibility="None"
                        FontSize="14"
                        FontWeight="Bold"
                        ContextMenuOpening="DataGrid_ContextMenuOpening"
                        PreviewMouseRightButtonDown="DataGrid_Palette_MouseRightButtonDown"
                        AllowDrop="True"
                        Drop="DataGrid_Palette_Drop"
                        >

                        <!--<MenuItem d:Header="禁用所选色号" Header="{Binding LanguageDic[Btn_DisableSelectedColor]}" Click="Button_PletteIndexDisable_Click"/>
                        <MenuItem d:Header="透明所选色号" Header="{Binding LanguageDic[Btn_TransparentSelectedColor]}" Click="Button_PletteIndexTransparent_Click"/>-->
                        
                        <DataGrid.ContextMenu>
                            <ContextMenu x:Name="DataGrid_PaletteContextMenu" MinWidth="160" MaxWidth="260" FontSize="15" VerticalAlignment="Top" HorizontalAlignment="Left">
                                <MenuItem d:Header="禁用所选色号" Header="{Binding Data.LanguageDic[Btn_DisableSelectedColor], Source={StaticResource Proxy}}" Click="Button_PletteIndexDisable_Click"/>
                                <MenuItem d:Header="透明所选色号" Header="{Binding Data.LanguageDic[Btn_TransparentSelectedColor], Source={StaticResource Proxy}}" Click="Button_PletteIndexTransparent_Click"/>
                                <Separator/>
                                <MenuItem d:Header="还原所选色号" Header="{Binding Data.LanguageDic[Btn_RestoreSelectedColor], Source={StaticResource Proxy}}" Click="Button_PletteIndexReset_Click"/>
                            </ContextMenu>
                        </DataGrid.ContextMenu>

                        <DataGrid.Columns>
                            <DataGridTemplateColumn Width="*">
                                <DataGridTemplateColumn.CellStyle>
                                    <Style TargetType="DataGridCell">
                                        <Setter Property="Background" Value="{Binding [Col0_Color]}"/>
                                    </Style>
                                </DataGridTemplateColumn.CellStyle>

                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Grid>
                                            <Grid Background="Black" Opacity="{Binding [Col0_DisableOpacity]}">
                                                <Path Fill="MediumVioletRed" Stretch="Fill" Data="M1024 85.460255L938.539745 0l-426.455131 426.62436L85.460255 0 0.169228 85.460255l426.455132 426.455131L0.169228 938.539745 85.460255 1023.830772l426.624359-426.455132 426.455131 426.455132 85.460255-85.291027L597.37564 511.915386z"/>
                                            </Grid>
                                            <Grid Opacity="{Binding [Col0_TransparentOpacity]}">
                                                <Rectangle Fill="DarkGray" Opacity="0.6"/>
                                                <Path Fill="Black" Stretch="Fill" Width="25" Height="15" HorizontalAlignment="Right" VerticalAlignment="Bottom" Data="M1023.99999999 1018.66666666l-896 0L1023.99999999 122.66666666z"/>
                                                <Path Fill="MediumVioletRed" Stretch="Fill" Width="20" Height="12" HorizontalAlignment="Right" VerticalAlignment="Bottom" Data="M1023.99999999 1018.66666666l-896 0L1023.99999999 122.66666666z"/>
                                            </Grid>

                                            <TextBlock Text="{Binding [Col0]}" Foreground="{Binding [Col0_TextColor]}" HorizontalAlignment="Center">
                                                <TextBlock.Style>
                                                    <Style TargetType="TextBlock">
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding IsSelected, RelativeSource={RelativeSource AncestorType=DataGridCell}}" Value="False">
                                                                <Setter Property="Visibility" Value="Hidden"/>
                                                            </DataTrigger>
                                                            <DataTrigger Binding="{Binding IsSelected, RelativeSource={RelativeSource AncestorType=DataGridCell}}" Value="True">
                                                                <Setter Property="Visibility" Value="Visible"/>
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </TextBlock.Style>
                                            </TextBlock>
                                        </Grid>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>

                            <DataGridTemplateColumn Width="*">
                                <DataGridTemplateColumn.CellStyle>
                                    <Style TargetType="DataGridCell">
                                        <Setter Property="Background" Value="{Binding [Col1_Color]}"/>
                                    </Style>
                                </DataGridTemplateColumn.CellStyle>

                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Grid>
                                            <Grid Background="Black" Opacity="{Binding [Col1_DisableOpacity]}">
                                                <Path Fill="MediumVioletRed" Stretch="Fill" Data="M1024 85.460255L938.539745 0l-426.455131 426.62436L85.460255 0 0.169228 85.460255l426.455132 426.455131L0.169228 938.539745 85.460255 1023.830772l426.624359-426.455132 426.455131 426.455132 85.460255-85.291027L597.37564 511.915386z"/>
                                            </Grid>
                                            <Grid Opacity="{Binding [Col1_TransparentOpacity]}">
                                                <Rectangle Fill="DarkGray" Opacity="0.6"/>
                                                <Path Fill="Black" Stretch="Fill" Width="25" Height="15" HorizontalAlignment="Right" VerticalAlignment="Bottom" Data="M1023.99999999 1018.66666666l-896 0L1023.99999999 122.66666666z"/>
                                                <Path Fill="MediumVioletRed" Stretch="Fill" Width="20" Height="12" HorizontalAlignment="Right" VerticalAlignment="Bottom" Data="M1023.99999999 1018.66666666l-896 0L1023.99999999 122.66666666z"/>
                                            </Grid>

                                            <TextBlock Text="{Binding [Col1]}" Foreground="{Binding [Col1_TextColor]}" HorizontalAlignment="Center">
                                                <TextBlock.Style>
                                                    <Style TargetType="TextBlock">
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding IsSelected, RelativeSource={RelativeSource AncestorType=DataGridCell}}" Value="False">
                                                                <Setter Property="Visibility" Value="Hidden"/>
                                                            </DataTrigger>
                                                            <DataTrigger Binding="{Binding IsSelected, RelativeSource={RelativeSource AncestorType=DataGridCell}}" Value="True">
                                                                <Setter Property="Visibility" Value="Visible"/>
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </TextBlock.Style>
                                            </TextBlock>
                                        </Grid>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>

                            <DataGridTemplateColumn Width="*">
                                <DataGridTemplateColumn.CellStyle>
                                    <Style TargetType="DataGridCell">
                                        <Setter Property="Background" Value="{Binding [Col2_Color]}"/>
                                    </Style>
                                </DataGridTemplateColumn.CellStyle>

                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Grid>
                                            <Grid Background="Black" Opacity="{Binding [Col2_DisableOpacity]}">
                                                <Path Fill="MediumVioletRed" Stretch="Fill" Data="M1024 85.460255L938.539745 0l-426.455131 426.62436L85.460255 0 0.169228 85.460255l426.455132 426.455131L0.169228 938.539745 85.460255 1023.830772l426.624359-426.455132 426.455131 426.455132 85.460255-85.291027L597.37564 511.915386z"/>
                                            </Grid>
                                            <Grid Opacity="{Binding [Col2_TransparentOpacity]}">
                                                <Rectangle Fill="DarkGray" Opacity="0.6"/>
                                                <Path Fill="Black" Stretch="Fill" Width="25" Height="15" HorizontalAlignment="Right" VerticalAlignment="Bottom" Data="M1023.99999999 1018.66666666l-896 0L1023.99999999 122.66666666z"/>
                                                <Path Fill="MediumVioletRed" Stretch="Fill" Width="20" Height="12" HorizontalAlignment="Right" VerticalAlignment="Bottom" Data="M1023.99999999 1018.66666666l-896 0L1023.99999999 122.66666666z"/>
                                            </Grid>

                                            <TextBlock Text="{Binding [Col2]}" Foreground="{Binding [Col2_TextColor]}" HorizontalAlignment="Center">
                                                <TextBlock.Style>
                                                    <Style TargetType="TextBlock">
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding IsSelected, RelativeSource={RelativeSource AncestorType=DataGridCell}}" Value="False">
                                                                <Setter Property="Visibility" Value="Hidden"/>
                                                            </DataTrigger>
                                                            <DataTrigger Binding="{Binding IsSelected, RelativeSource={RelativeSource AncestorType=DataGridCell}}" Value="True">
                                                                <Setter Property="Visibility" Value="Visible"/>
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </TextBlock.Style>
                                            </TextBlock>
                                        </Grid>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>

                            <DataGridTemplateColumn Width="*">
                                <DataGridTemplateColumn.CellStyle>
                                    <Style TargetType="DataGridCell">
                                        <Setter Property="Background" Value="{Binding [Col3_Color]}"/>
                                    </Style>
                                </DataGridTemplateColumn.CellStyle>

                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Grid>
                                            <Grid Background="Black" Opacity="{Binding [Col3_DisableOpacity]}">
                                                <Path Fill="MediumVioletRed" Stretch="Fill" Data="M1024 85.460255L938.539745 0l-426.455131 426.62436L85.460255 0 0.169228 85.460255l426.455132 426.455131L0.169228 938.539745 85.460255 1023.830772l426.624359-426.455132 426.455131 426.455132 85.460255-85.291027L597.37564 511.915386z"/>
                                            </Grid>
                                            <Grid Opacity="{Binding [Col3_TransparentOpacity]}">
                                                <Rectangle Fill="DarkGray" Opacity="0.6"/>
                                                <Path Fill="Black" Stretch="Fill" Width="25" Height="15" HorizontalAlignment="Right" VerticalAlignment="Bottom" Data="M1023.99999999 1018.66666666l-896 0L1023.99999999 122.66666666z"/>
                                                <Path Fill="MediumVioletRed" Stretch="Fill" Width="20" Height="12" HorizontalAlignment="Right" VerticalAlignment="Bottom" Data="M1023.99999999 1018.66666666l-896 0L1023.99999999 122.66666666z"/>
                                            </Grid>

                                            <TextBlock Text="{Binding [Col3]}" Foreground="{Binding [Col3_TextColor]}" HorizontalAlignment="Center">
                                                <TextBlock.Style>
                                                    <Style TargetType="TextBlock">
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding IsSelected, RelativeSource={RelativeSource AncestorType=DataGridCell}}" Value="False">
                                                                <Setter Property="Visibility" Value="Hidden"/>
                                                            </DataTrigger>
                                                            <DataTrigger Binding="{Binding IsSelected, RelativeSource={RelativeSource AncestorType=DataGridCell}}" Value="True">
                                                                <Setter Property="Visibility" Value="Visible"/>
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </TextBlock.Style>
                                            </TextBlock>
                                        </Grid>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>

                            <DataGridTemplateColumn Width="*">
                                <DataGridTemplateColumn.CellStyle>
                                    <Style TargetType="DataGridCell">
                                        <Setter Property="Background" Value="{Binding [Col4_Color]}"/>
                                    </Style>
                                </DataGridTemplateColumn.CellStyle>

                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Grid>
                                            <Grid Background="Black" Opacity="{Binding [Col4_DisableOpacity]}">
                                                <Path Fill="MediumVioletRed" Stretch="Fill" Data="M1024 85.460255L938.539745 0l-426.455131 426.62436L85.460255 0 0.169228 85.460255l426.455132 426.455131L0.169228 938.539745 85.460255 1023.830772l426.624359-426.455132 426.455131 426.455132 85.460255-85.291027L597.37564 511.915386z"/>
                                            </Grid>
                                            <Grid Opacity="{Binding [Col4_TransparentOpacity]}">
                                                <Rectangle Fill="DarkGray" Opacity="0.6"/>
                                                <Path Fill="Black" Stretch="Fill" Width="25" Height="15" HorizontalAlignment="Right" VerticalAlignment="Bottom" Data="M1023.99999999 1018.66666666l-896 0L1023.99999999 122.66666666z"/>
                                                <Path Fill="MediumVioletRed" Stretch="Fill" Width="20" Height="12" HorizontalAlignment="Right" VerticalAlignment="Bottom" Data="M1023.99999999 1018.66666666l-896 0L1023.99999999 122.66666666z"/>
                                            </Grid>

                                            <TextBlock Text="{Binding [Col4]}" Foreground="{Binding [Col4_TextColor]}" HorizontalAlignment="Center">
                                                <TextBlock.Style>
                                                    <Style TargetType="TextBlock">
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding IsSelected, RelativeSource={RelativeSource AncestorType=DataGridCell}}" Value="False">
                                                                <Setter Property="Visibility" Value="Hidden"/>
                                                            </DataTrigger>
                                                            <DataTrigger Binding="{Binding IsSelected, RelativeSource={RelativeSource AncestorType=DataGridCell}}" Value="True">
                                                                <Setter Property="Visibility" Value="Visible"/>
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </TextBlock.Style>
                                            </TextBlock>
                                        </Grid>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>

                            <DataGridTemplateColumn Width="*">
                                <DataGridTemplateColumn.CellStyle>
                                    <Style TargetType="DataGridCell">
                                        <Setter Property="Background" Value="{Binding [Col5_Color]}"/>
                                    </Style>
                                </DataGridTemplateColumn.CellStyle>

                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Grid>
                                            <Grid Background="Black" Opacity="{Binding [Col5_DisableOpacity]}">
                                                <Path Fill="MediumVioletRed" Stretch="Fill" Data="M1024 85.460255L938.539745 0l-426.455131 426.62436L85.460255 0 0.169228 85.460255l426.455132 426.455131L0.169228 938.539745 85.460255 1023.830772l426.624359-426.455132 426.455131 426.455132 85.460255-85.291027L597.37564 511.915386z"/>
                                            </Grid>
                                            <Grid Opacity="{Binding [Col5_TransparentOpacity]}">
                                                <Rectangle Fill="DarkGray" Opacity="0.6"/>
                                                <Path Fill="Black" Stretch="Fill" Width="25" Height="15" HorizontalAlignment="Right" VerticalAlignment="Bottom" Data="M1023.99999999 1018.66666666l-896 0L1023.99999999 122.66666666z"/>
                                                <Path Fill="MediumVioletRed" Stretch="Fill" Width="20" Height="12" HorizontalAlignment="Right" VerticalAlignment="Bottom" Data="M1023.99999999 1018.66666666l-896 0L1023.99999999 122.66666666z"/>
                                            </Grid>

                                            <TextBlock Text="{Binding [Col5]}" Foreground="{Binding [Col5_TextColor]}" HorizontalAlignment="Center">
                                                <TextBlock.Style>
                                                    <Style TargetType="TextBlock">
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding IsSelected, RelativeSource={RelativeSource AncestorType=DataGridCell}}" Value="False">
                                                                <Setter Property="Visibility" Value="Hidden"/>
                                                            </DataTrigger>
                                                            <DataTrigger Binding="{Binding IsSelected, RelativeSource={RelativeSource AncestorType=DataGridCell}}" Value="True">
                                                                <Setter Property="Visibility" Value="Visible"/>
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </TextBlock.Style>
                                            </TextBlock>
                                        </Grid>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>

                            <DataGridTemplateColumn Width="*">
                                <DataGridTemplateColumn.CellStyle>
                                    <Style TargetType="DataGridCell">
                                        <Setter Property="Background" Value="{Binding [Col6_Color]}"/>
                                    </Style>
                                </DataGridTemplateColumn.CellStyle>

                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Grid>
                                            <Grid Background="Black" Opacity="{Binding [Col6_DisableOpacity]}">
                                                <Path Fill="MediumVioletRed" Stretch="Fill" Data="M1024 85.460255L938.539745 0l-426.455131 426.62436L85.460255 0 0.169228 85.460255l426.455132 426.455131L0.169228 938.539745 85.460255 1023.830772l426.624359-426.455132 426.455131 426.455132 85.460255-85.291027L597.37564 511.915386z"/>
                                            </Grid>
                                            <Grid Opacity="{Binding [Col6_TransparentOpacity]}">
                                                <Rectangle Fill="DarkGray" Opacity="0.6"/>
                                                <Path Fill="Black" Stretch="Fill" Width="25" Height="15" HorizontalAlignment="Right" VerticalAlignment="Bottom" Data="M1023.99999999 1018.66666666l-896 0L1023.99999999 122.66666666z"/>
                                                <Path Fill="MediumVioletRed" Stretch="Fill" Width="20" Height="12" HorizontalAlignment="Right" VerticalAlignment="Bottom" Data="M1023.99999999 1018.66666666l-896 0L1023.99999999 122.66666666z"/>
                                            </Grid>

                                            <TextBlock Text="{Binding [Col6]}" Foreground="{Binding [Col6_TextColor]}" HorizontalAlignment="Center">
                                                <TextBlock.Style>
                                                    <Style TargetType="TextBlock">
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding IsSelected, RelativeSource={RelativeSource AncestorType=DataGridCell}}" Value="False">
                                                                <Setter Property="Visibility" Value="Hidden"/>
                                                            </DataTrigger>
                                                            <DataTrigger Binding="{Binding IsSelected, RelativeSource={RelativeSource AncestorType=DataGridCell}}" Value="True">
                                                                <Setter Property="Visibility" Value="Visible"/>
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </TextBlock.Style>
                                            </TextBlock>
                                        </Grid>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>

                            <DataGridTemplateColumn Width="*">
                                <!-- 定义单元格的样式 -->
                                <DataGridTemplateColumn.CellStyle>
                                    <Style TargetType="DataGridCell">
                                        <Setter Property="Background" Value="{Binding [Col7_Color]}"/>
                                    </Style>
                                </DataGridTemplateColumn.CellStyle>

                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Grid>
                                            <Grid Background="Black" Opacity="{Binding [Col7_DisableOpacity]}">
                                                <Path Fill="MediumVioletRed" Stretch="Fill" Data="M1024 85.460255L938.539745 0l-426.455131 426.62436L85.460255 0 0.169228 85.460255l426.455132 426.455131L0.169228 938.539745 85.460255 1023.830772l426.624359-426.455132 426.455131 426.455132 85.460255-85.291027L597.37564 511.915386z"/>
                                            </Grid>
                                            <Grid Opacity="{Binding [Col7_TransparentOpacity]}">
                                                <Rectangle Fill="DarkGray" Opacity="0.6"/>
                                                <Path Fill="Black" Stretch="Fill" Width="25" Height="15" HorizontalAlignment="Right" VerticalAlignment="Bottom" Data="M1023.99999999 1018.66666666l-896 0L1023.99999999 122.66666666z"/>
                                                <Path Fill="MediumVioletRed" Stretch="Fill" Width="20" Height="12" HorizontalAlignment="Right" VerticalAlignment="Bottom" Data="M1023.99999999 1018.66666666l-896 0L1023.99999999 122.66666666z"/>
                                            </Grid>

                                            <TextBlock Text="{Binding [Col7]}" Foreground="{Binding [Col7_TextColor]}" HorizontalAlignment="Center">
                                                <TextBlock.Style>
                                                    <Style TargetType="TextBlock">
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding IsSelected, RelativeSource={RelativeSource AncestorType=DataGridCell}}" Value="False">
                                                                <Setter Property="Visibility" Value="Hidden"/>
                                                            </DataTrigger>
                                                            <DataTrigger Binding="{Binding IsSelected, RelativeSource={RelativeSource AncestorType=DataGridCell}}" Value="True">
                                                                <Setter Property="Visibility" Value="Visible"/>
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </TextBlock.Style>
                                            </TextBlock>
                                        </Grid>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                        </DataGrid.Columns>
                    </DataGrid>
                </Viewbox>

                <Viewbox Grid.Row="2" MaxHeight="80" HorizontalAlignment="Left">
                    <StackPanel>
                        <Button d:Content="载入最后保存的色盘" Content="{Binding LanguageDic[Btn_LoadLastSavePalette]}" Margin="0 10 0 0" Click="Button_LoadLastSavePalette_Click" IsEnabled="{Binding UIEnable}"/>
                        <Button d:Content="载入色盘(或文件拖入上方)" Content="{Binding LanguageDic[Btn_LoadPalette]}" Margin="0 10 0 0" Click="Button_LoadPalette_Click" IsEnabled="{Binding UIEnable}"/>
                    </StackPanel>
                </Viewbox>

                <Viewbox Grid.Row="4" MaxHeight="30" HorizontalAlignment="Right" VerticalAlignment="Bottom">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock d:Text="操作进度:" Text="{Binding LanguageDic[Text_Progress]}" FontSize="16" Margin="0 0 0 0"/>
                        <TextBlock x:Name="TextBlock_Progress" FontSize="16" d:Text="0 / 0" Text="{Binding ProgressUi, Mode=OneWay, UpdateSourceTrigger=PropertyChanged}" Width="100" Margin="10 0 0 0"/>
                    </StackPanel>
                </Viewbox>
            </Grid>
        </Grid>
    </Grid>
</Window>
